<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Building simple Shiny app with a chatbot • GitAI</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Building simple Shiny app with a chatbot">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">GitAI</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/building-shiny-app-chatbot.html">Building simple Shiny app with a chatbot</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Building simple Shiny app with a chatbot</h1>
            
      

      <div class="d-none name"><code>building-shiny-app-chatbot.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="demo-app-specs">Demo App Specs<a class="anchor" aria-label="anchor" href="#demo-app-specs"></a>
</h2>
<p>In this vignette we show how to build a simple Shiny app with a chat
bot, like this one: <a href="https://kalimu.shinyapps.io/GitAI-demo/" class="external-link">GitAI-demo</a></p>
<p><img src="demoapp.gif"></p>
<p>As you can see, the demo app has a chatbot that answers are based on
the results from processed content of multiple git repositories.</p>
<p>To build this app:</p>
<ul>
<li>We scanned 800+ repositories in multiple public GitHub
organizations: <code>r-world-devs</code>, <code>openpharma</code>,
<code>pharmaverse</code>, <code>tidymodels</code>, <code>r-lib</code>,
<code>rstudio</code>, <code>tidyverse</code>,
<code>insightsengineering</code>.</li>
<li>In the repositories we have scanned the following files types:
<code>DESCRIPTION</code>, <code>*.md</code>, and <code>*.Rmd</code>, so
it includes files like <code>README.md</code> or R package
vignettes.</li>
<li>We have used simple and cheap LLM <code>gpt-4o-mini</code> from
OpenAI.</li>
<li>For embeddings we use <code>multilingual-e5-large</code> embedding
model from Pinecone as well as its vector database with 1024
dimensions.</li>
</ul>
<p>The overall one-time cost of processing all 800+ repositories is
<strong>less then $1</strong> with this setup (yes, one USD!). Even more
impressive results can be achieved with more powerful LLMs, and
higher-dimensional embeddings.</p>
<div class="section level3">
<h3 id="processing-git-repositories-with-llm">Processing Git repositories with LLM<a class="anchor" aria-label="anchor" href="#processing-git-repositories-with-llm"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">GitAI</span><span class="op">)</span></span></code></pre></div>
<p>First, we need to set up a <code>GitAI</code> project which we call
<code>my_project</code>. We also setting up a <code>Pinecone</code>
database and default provided of LLM which is <code>openai</code> with
its <code>gpt-4o-mini</code> model.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_project</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/initialize_project.html">initialize_project</a></span><span class="op">(</span><span class="st">"gitai-demo"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/set_database.html">set_database</a></span><span class="op">(</span></span>
<span>    provider  <span class="op">=</span> <span class="st">"Pinecone"</span>, </span>
<span>    index     <span class="op">=</span> <span class="st">"gitai"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/set_llm.html">set_llm</a></span><span class="op">(</span>seed <span class="op">=</span> <span class="fl">1014</span>, api_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>temperature <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Next, we need to provide a list of repositories or groups of
repositories that we want to scan. We also define the files types that
we want to process within each repository (if present).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_project</span> <span class="op">&lt;-</span> <span class="va">my_project</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/set_github_repos.html">set_github_repos</a></span><span class="op">(</span></span>
<span>    repos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"r-world-devs/GitStats"</span>, </span>
<span>      <span class="st">"r-world-devs/GitAI"</span>, </span>
<span>      <span class="st">"r-world-devs/cohortBuilder"</span>, </span>
<span>      <span class="st">"r-world-devs/shinyCohortBuilder"</span>,</span>
<span>      <span class="st">"r-world-devs/shinyQueryBuilder"</span>, </span>
<span>      <span class="st">"r-world-devs/queryBuilder"</span>, </span>
<span>      <span class="st">"r-world-devs/shinyGizmo"</span>, </span>
<span>      <span class="st">"r-world-devs/shinyTimelines"</span>,</span>
<span>      <span class="st">"openpharma/DataFakeR"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    orgs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"insightsengineering"</span>,</span>
<span>      <span class="st">"openpharma"</span>,</span>
<span>      <span class="st">"pharmaverse"</span>,</span>
<span>      <span class="st">"tidymodels"</span>,</span>
<span>      <span class="st">"r-lib"</span>,</span>
<span>      <span class="st">"rstudio"</span>,</span>
<span>      <span class="st">"tidyverse"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_files.html">add_files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"DESCRIPTION"</span>,</span>
<span>    <span class="st">"*.md"</span>,</span>
<span>    <span class="st">"*.Rmd"</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Next we need to define a prompt for the LLM. This might be improved
in multiple iterations to get the best possible results.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_project</span> <span class="op">&lt;-</span> <span class="va">my_project</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/set_prompt.html">set_prompt</a></span><span class="op">(</span><span class="st">r"(</span></span>
<span><span class="st">    Write up to ten paragraphs of summary for a project based on given input.</span></span>
<span><span class="st">    Be precise and to the point in your answers.</span></span>
<span><span class="st">    Mention core functionality and all main features of the project.</span></span>
<span><span class="st">    If available, mention brifly the technology used in the project </span></span>
<span><span class="st">    (like R, Python, etc).</span></span>
<span><span class="st">    If available, mention brifly if a project is an R package, shiny app, </span></span>
<span><span class="st">    or other type of tool.</span></span>
<span><span class="st">  )"</span><span class="op">)</span></span></code></pre></div>
<p>Next step is optional, and hopefully won’t be needed in the future.
What it does it changes the default <code>chat_perform_value</code>
function in the <code>ellmer</code> package to make it more robust for
the LLM provider API errors. If you don’t get any timeout errors, you
can safely ignore this step.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ellmer</span><span class="fu">:::</span><span class="va">chat_perform_value</span></span>
<span><span class="va">custom_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">provider</span>, <span class="va">req</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="va">req</span> <span class="op">&lt;-</span> <span class="va">req</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/req_timeout.html" class="external-link">req_timeout</a></span><span class="op">(</span><span class="fl">60</span> <span class="op">*</span> <span class="fl">10</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/req_retry.html" class="external-link">req_retry</a></span><span class="op">(</span></span>
<span>      max_tries <span class="op">=</span> <span class="fl">10</span>,</span>
<span>      retry_on_failure <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span> </span>
<span>  </span>
<span>  <span class="va">req</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/req_perform.html" class="external-link">req_perform</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/resp_body_raw.html" class="external-link">resp_body_json</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/bindenv.html" class="external-link">unlockBinding</a></span><span class="op">(</span><span class="st">"chat_perform_value"</span>, <span class="fu"><a href="https://rdrr.io/r/base/ns-internal.html" class="external-link">asNamespace</a></span><span class="op">(</span><span class="st">"ellmer"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/assign.html" class="external-link">assign</a></span><span class="op">(</span><span class="st">"chat_perform_value"</span>, <span class="va">custom_function</span>, envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ns-internal.html" class="external-link">asNamespace</a></span><span class="op">(</span><span class="st">"ellmer"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/bindenv.html" class="external-link">lockBinding</a></span><span class="op">(</span><span class="st">"chat_perform_value"</span>, <span class="fu"><a href="https://rdrr.io/r/base/ns-internal.html" class="external-link">asNamespace</a></span><span class="op">(</span><span class="st">"ellmer"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now you can process the repositories with a single function call. As
we defined vector database, the result will be written to it.</p>
<p>In case of error you can just repeat the function call. If the
repository content hasn’t changed, and the results are already in the
database, the function will skip processing the repository and move to
the next one.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_repos.html">process_repos</a></span><span class="op">(</span><span class="va">my_project</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="semantic-search-queries">Semantic search queries<a class="anchor" aria-label="anchor" href="#semantic-search-queries"></a>
</h2>
<p>Once the repositories are processed and stored in a vector database,
we can use semantic search queries to find the results.</p>
<p>As you can see for that we need to define only our project, database,
and LLM.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_project</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/initialize_project.html">initialize_project</a></span><span class="op">(</span><span class="st">"gitai-demo"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/set_database.html">set_database</a></span><span class="op">(</span></span>
<span>    provider  <span class="op">=</span> <span class="st">"Pinecone"</span>, </span>
<span>    index     <span class="op">=</span> <span class="st">"gitai"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/set_llm.html">set_llm</a></span><span class="op">(</span>seed <span class="op">=</span> <span class="fl">1014</span>, api_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>temperature <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">my_project</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/find_records.html">find_records</a></span><span class="op">(</span></span>
<span>    <span class="st">"How can I create fake data based on SQL tables?"</span>, </span>
<span>    top_k <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">walk</a></span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span></span>
<span>    <span class="va">.x</span><span class="op">$</span><span class="va">metadata</span><span class="op">$</span><span class="va">text</span> <span class="op">|&gt;</span> </span>
<span>      <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html" class="external-link">str_sub</a></span><span class="op">(</span>end <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>      <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_wrap.html" class="external-link">str_wrap</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">80</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"..."</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span> </span>
<span><span class="co">#&gt; DataFakeR is an R package designed to generate fake data for relational</span></span>
<span><span class="co">#&gt; databases while preserving the structure and constraints of the original data.</span></span>
<span><span class="co">#&gt; The package is particularly useful for developers and data scientists who need</span></span>
<span><span class="co">#&gt; to create realistic datasets for testing, development, or demonstration purposes</span></span>
<span><span class="co">#&gt; without exposing sensitive information. The current version, 0.1.3, includes</span></span>
<span><span class="co">#&gt; several enhancements and bug fixes, making it a robust tool for data simulation.</span></span>
<span><span class="co">#&gt; The core functionality of DataFakeR revolves around its ability to read a</span></span>
<span><span class="co">#&gt; schema description in YAML format, which defines the structure of the database</span></span>
<span><span class="co">#&gt; tables, including columns, data types, constraints, and relationships. Users can</span></span>
<span><span class="co">#&gt; source this schema from an existing database or define it manually. The package</span></span>
<span><span class="co">#&gt; supports various data types, including character, numeric, integer, logical,</span></span>
<span><span class="co">#&gt; and date, allowing for a wide range of data generation scenarios. One of the</span></span>
<span><span class="co">#&gt; standout features of DataFakeR is its support for determinist...</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="shiny-chatbot-with-rag">Shiny chatbot with RAG<a class="anchor" aria-label="anchor" href="#shiny-chatbot-with-rag"></a>
</h2>
<p>Now it’s time for building our shiny app.</p>
<p>The app will use <code>shinychat</code> for a chatbot and
<code>ellmer</code> for answering user questions. But before providing
the answer to the user, the prompt will be augmented with top k results
from semantic search.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.posit.co/" class="external-link">shiny</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jcheng5/shinychat" class="external-link">shinychat</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">GitAI</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gitai</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/initialize_project.html">initialize_project</a></span><span class="op">(</span><span class="st">"gitai-demo"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/set_database.html">set_database</a></span><span class="op">(</span>index <span class="op">=</span> <span class="st">"gitai"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/set_llm.html">set_llm</a></span><span class="op">(</span>seed <span class="op">=</span> <span class="fl">1014</span>, api_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>temperature <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/set_prompt.html">set_prompt</a></span><span class="op">(</span><span class="st">r"(</span></span>
<span><span class="st">    As a helpful assistant, answer user question </span></span>
<span><span class="st">    using only the provided input. </span></span>
<span><span class="st">    Use only provided with the query known input </span></span>
<span><span class="st">    that is most relevent to the user's query.</span></span>
<span><span class="st">    Do not use any other information </span></span>
<span><span class="st">    apart from the input provided with the query.</span></span>
<span><span class="st">    Be concise but provide all important information.</span></span>
<span><span class="st">    Also awalys provide link to mentioned git repositories </span></span>
<span><span class="st">    with visible full URL for example: https://github.com/some_repository. </span></span>
<span><span class="st">    Do not mask it with any other text.</span></span>
<span><span class="st">    )"</span><span class="op">)</span></span>
<span>    </span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu">bslib</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/bslib/reference/page.html" class="external-link">page_fluid</a></span><span class="op">(</span></span>
<span>  <span class="fu">bslib</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/bslib/reference/sidebar.html" class="external-link">layout_sidebar</a></span><span class="op">(</span></span>
<span>    sidebar <span class="op">=</span> <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html" class="external-link">sliderInput</a></span><span class="op">(</span></span>
<span>      <span class="st">"top_k"</span>, </span>
<span>      <span class="st">"Use top K results"</span>, </span>
<span>      step <span class="op">=</span> <span class="fl">1</span>,</span>
<span>      min <span class="op">=</span> <span class="fl">1</span>, </span>
<span>      max <span class="op">=</span> <span class="fl">10</span>, </span>
<span>      value <span class="op">=</span> <span class="fl">5</span></span>
<span>    <span class="op">)</span>,</span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shinychat/man/chat_ui.html" class="external-link">chat_ui</a></span><span class="op">(</span><span class="st">"chat"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="va">user_chatbot</span> <span class="op">&lt;-</span> <span class="va">gitai</span><span class="op">$</span><span class="va">llm</span><span class="op">$</span><span class="fu">clone</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html" class="external-link">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">chat_user_input</span>, <span class="op">{</span></span>
<span></span>
<span>    <span class="va">query</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">chat_user_input</span></span>
<span></span>
<span>    <span class="va">stream</span> <span class="op">&lt;-</span> <span class="va">user_chatbot</span><span class="op">$</span><span class="fu">stream_async</span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span></span>
<span>        <span class="st">"User query:"</span>, <span class="va">query</span>, <span class="st">"\n\n"</span>,</span>
<span>        <span class="st">"Known input provided for the answer:\n\n"</span>, </span>
<span>        <span class="va">gitai</span><span class="op">$</span><span class="va">db</span><span class="op">$</span><span class="fu">find_records</span><span class="op">(</span>query <span class="op">=</span> <span class="va">query</span>, top_k <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">top_k</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shinychat/man/chat_append.html" class="external-link">chat_append</a></span><span class="op">(</span><span class="st">"chat"</span>, <span class="va">stream</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html" class="external-link">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kamil Wais, Krystian Igras, Maciej Banas.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
